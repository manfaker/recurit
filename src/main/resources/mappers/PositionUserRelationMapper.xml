<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shenzhen.recurit.dao.PositionUserRelationMapper">

        <resultMap id="baseResultMap" type="com.shenzhen.recurit.vo.PositionUserRelationVO">
            <id column="id" property="id"/>
            <result column="position_id" property="positionId"/>
            <result column="user_code" property="userCode"/>
            <result column="status" property="status"/>
            <result column="relation_status" property="relationStatus"/>
            <result column="create_date" property="createDate"/>
            <result column="update_date" property="updateDate"/>
            <result column="creater" property="creater"/>
            <result column="updater" property="updater"/>
        </resultMap>

        <sql id="baseResult">
            position_id,user_code,status,relation_status,create_date,update_date,creater,updater
        </sql>

        <insert id="saveBatchRelation">
            insert into tab_position_user_relation(<include refid="baseResult"/>)
                values
            <foreach collection="relations" item="relation" separator=",">
                (#{relation.positionId},#{relation.userCode},#{relation.status},#{relation.relationStatus}
                ,#{relation.createDate},#{relation.updateDate},#{relation.creater},#{relation.updater})
            </foreach>
        </insert>

        <select id="getRelationByPostionAndUser" resultMap="baseResultMap">
            select id,<include refid="baseResult"/> from tab_position_user_relation
                where user_code = #{userCode} and relation_status = #{relationStatus} and status = 1
                    and position_id in
                    <foreach collection="listPositionId" item="positionId" open="(" close=")" separator=",">
                        #{positionId}
                    </foreach>
        </select>

        <update id="deleteBatchRelation">
            update tab_position_user_relation set status =2
            where user_code = #{userCode} and relation_status = #{relationStatus} and status = 1
            and position_id in
            <foreach collection="listPositionId" item="positionId" open="(" close=")" separator=",">
                #{positionId}
            </foreach>
        </update>

</mapper>
